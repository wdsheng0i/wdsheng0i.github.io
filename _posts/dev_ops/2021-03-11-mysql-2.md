---
layout: post
title: Mysql单机部署
category: dev-ops
tags: [dev-ops]
---

Mysql单机部署

## 参考资料
- 官网地址：
- 下载地址：
- 文档地址：

## 一、windows安装mysql
- [Windows下安装MySQL详细教程](https://www.cnblogs.com/zhangkanghui/p/9613844.html)       
- [win环境安装说明](https://blog.csdn.net/qq_43715354/article/details/109354222?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.compare&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.compare)

问题记录：  
``` 
1.装 微软常用运行库合集_2019.07.20_X64.exe  //网上搜、网盘已上传

2.忘改临时密码，且临时密码失效：通过命令行修改  
mysql -u root -p  
alter user user() identified by "root";
```

## 二、Linux安装mysql
1.检查卸载旧版本    
``` 
## 检查系统版本： (64位还是32位)    
 cat /etc/system-release  
 uname -a

## 检查是否安装mysql  
rpm -qa mysql*   //rpm     检查  
yum list mysql*   //yum      检查

## 卸载mysql(如果没安装mysql直接跳过此步骤)  
yum remove mysql*  //yum     卸载  
rpm -e mysql*  //rpm     卸载  
```

备注:这个只能适用于用yum安装的mysql,如果是用安装包安装的直接将安装包删除。

2.离线包安装[不依赖外网](https://blog.csdn.net/qq_36631900/article/details/102482768)    
```
## 官网下载安装包、解压： 
https://dev.mysql.com/downloads/mysql/
  
1.将下载好的mysql-8.0.17-linux-glibc2.12-x86_64.tar.xz上传到usr/local/mysql目录下(如果没有该目录可以依次建文件夹)

2. .tar.xz解压是  tar -xvf mysql-8.0.17-linux-glibc2.12-x86_64.tar.xz
   .tar.gz解压是  tar -zvxf mysql-8.0.17-linux-glibc2.12-x86_64.tar.xz

## mysql安装
1.重命名解压文件：进入mysql文件夹执行命令：mv mysql-8.0.17-linux-glibc2.12-x86_64 mysql
移动重命名后文件内的所有文件：进入重名名的mysql文件夹执行命令:mv * usr/local/mysql 
将刚刚空了的mysql文件夹删除；最后的结果mysql可执行文件bin的全路径应该是usr/local/mysql/bin

2.为系统添加mysql 组和用户：groupadd mysql和useradd -r -g mysql mysql

3.进入 /usr/local/mysql 目录下，修改相关权限：chown -R mysql:mysql ./   //修改当前目录为mysql用户

4.如果你/etc下没有my.cnf文件, 新建一个my-defalut.cnf文件,将其复制到/etc/my.cnf
touch my-defalut.cnf //新建一个文件
chmod 755 my-defalut.cnf // 赋予权限
cp my-defalut.cnf /etc/my.cnf // 将文件复制到/etc/ 目录下，并更名为my.cnf 文件名

5.my.cnf 的信息如下
[mysqld]
#设置表名大小写不敏感
lower_case_table_names=1

# 连接超时wait_timeout设置
wait_timeout=1800
interactive_timeout=1800

#设置mysql安装目录
basedir=/usr/local/mysql

#设置mysql数据库的数据存放目录
datadir=/usr/local/mysql/data
port=3306
socket=/tmp/mysql.sock

#设置mysql的日志文件位置（这个配置文件先不要放开，不然会报找不到Mysql.log文件，等启动后再放开，在重启）
#log-error=/var/log/mysql.log

#注意了,小细节，这里的 $hostname 是linux的主机名。一般每个人主机名都是不一样的。
pid-file=/usr/local/mysql/data/$hostname.pid
sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES

6.mysql初始化操作,记录下临时密码,之后第一次登录的时候会用到。
bin/mysqld --initialize --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data
//运行完成会生成一个暂时的密码

7.为mysql配置环境变量。 vim /etc/profile // 打开profile文件在最后追加下面命令
export MYSQL_HOME
MYSQL_HOME=/usr/local/mysql
export PATH=$PATH:$MYSQL_HOME/lib:$MYSQL_HOME/bin

退出后让其立马生效命令：source /etc/profile

8.设置为开机自启动项，依次执行下面代码
cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql
chmod +x /etc/init.d/mysql  //添加可执行权限。
chkconfig --add mysql  // 注册启动服务
输入chkconfig --list //查看是否添加成功。
 
9.启动msyql，并登陆
service mysql start //开启服务器。

注意：如果启动报了pid找不到的错误，直接把my.cnf中pid-file=/usr/local/mysql/data/$hostname.pid删掉，在启动就可以了

mysql -uroot -p //登录进入mysql，然后提示输入密码。

10.输入初始化过程中生成的临时密码，然后回车就行。进入一下页面。

11.进入mysql后，修改密码。不然你什么也做不了。
alter user 'root'@'localhost' identified by 'your_password';
其中'your_password'是你设置的新密码

11.创建远程操作账户，进行远程访问的授权,并更新权限，依次执行以下代码：
create user 'root'@'%' identified with mysql_native_password by '123456';
grant all privileges on *.* to 'root'@'%' with grant option;
flush privileges;

备注：如果创建远程账号的密码错了，修改方法点击这里https://blog.csdn.net/qq_36631900/article/details/103404515

12.本地用telnet连接测试下能否连接，命令是：telnet 你安装数据库的服务器ip 3306
如果直接进入全黑界面，这就代表远程访问成功，或者你也可以用navicat连接尝试
```

## 三、常用命令操作
- 登录: mysql -u root -p
- 查看库：show databases;
- 切换库: use test_db;
- 查看表：show tables;
- 查看表DDL：desc t_student;
- 查看版本信息
    - 1 在命令行登录mysql，即可看到mysql的版本号
    - 2.在命令行使用status查看
    - 3.mysql> select version();
- grant [用户授权](https://blog.csdn.net/weixin_40918067/article/details/117337647)

``` 
mysql> grant all privileges on testdb.* to 'userA'@'%' identified by '123456' with grant option;
```

- 预查看执行计划：mysql-v8.0以上支持树状结果查看
  
```
EXPLAIN FORMAT=tree
SELECT name from t_student where sex = 'man' and score > 95 ORDER BY score desc;
```
![](https://wdsheng0i.github.io/assets/images/2021/mysql/mysql-explain-tree.png)  

- 查看执行计划： 

```
EXPLAIN ANALYZE 
SELECT name from t_student where sex = 'man' and score > 95 ORDER BY score desc;
```

## 四、mysql常见问题汇总
1.数据库链接数太多：too many connection，修改链接超时时间    
```
show processlist;
show global variables like '%timeout%';
show session variables like '%timeout%';
show global variables like 'wait_timeout';  
set global wait_timeout=1800;
set global interactive_timeout=1800;
set session wait_timeout=600;
set session interactive_timeout=600;
```

2.大小写敏感，修改my.cnf 的信息如下  
```
[mysqld]
#设置表名大小写不敏感
lower_case_table_names=1
```

3.[MySQL主从同步相关-主从多久的延迟](https://blog.csdn.net/jiao_fuyou/article/details/14224069)  
使用master_delay选项可以控制延迟，使用change master to可以设定延迟多少秒，mysql复制默认延迟是0秒   

4.mysql主从不同步  
- [show slave status \G; 详解](https://blog.csdn.net/songmao3145/article/details/77448512)
- [mysql主从数据库不同步的3种解决方法](https://wenku.baidu.com/view/26b75b9af221dd36a32d7375a417866fb84ac0e8.html)

``` 
# 到Slave上查看
mysql> show slave status;
Slave_IO_Running: Yes
Slave_SQL_Running: No

可见是Slave不同步 
``` 

